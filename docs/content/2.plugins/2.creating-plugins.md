---
title: Creating a Plugin
description: Build your own Universal Data Layer plugin
navigation:
  icon: i-lucide-package-plus
---

## Creating Your First Plugin

Creating a UDL plugin is straightforward. A plugin is essentially a package with a `udl.config.js` file that defines its configuration and behavior.

## Plugin Structure

At minimum, a plugin needs:

```
my-plugin/
├── package.json
├── udl.config.js
└── ... (your plugin code)
```

## Basic Plugin Configuration

Create a `udl.config.js` file at the root of your plugin:

```javascript
// udl.config.js
export const config = {
  type: 'source',           // Plugin type: 'source' or 'core'
  name: 'my-plugin',        // Plugin name
  version: '1.0.0',         // Plugin version
};

export function onLoad({ options, config }) {
  console.log('My plugin loaded!');
  console.log('Options:', options);
  console.log('App config:', config);
}
```

## Plugin Types

### Source Plugin

Source plugins connect to external data sources:

```javascript
export const config = {
  type: 'source',
  name: 'my-data-source',
  version: '1.0.0',
};

export function onLoad({ options, config }) {
  // Initialize your data source connection
  const apiKey = options?.apiKey;
  const spaceId = options?.spaceId;

  console.log(`Connecting to data source with space: ${spaceId}`);

  // Set up data fetching logic, GraphQL schema extensions, etc.
}
```

### Core Plugin

Core plugins extend the UDL system functionality:

```javascript
export const config = {
  type: 'core',
  name: 'my-core-plugin',
  version: '1.0.0',
};

export function onLoad({ options, config }) {
  // Extend core functionality
  // Add middleware, modify schema, etc.
}
```

## The onLoad Hook

The `onLoad` function is your plugin's initialization point. It receives a context object with:

### Context Properties

#### `options` (object)

Plugin-specific options passed during registration:

```javascript
export function onLoad({ options }) {
  const {
    apiKey,
    environment,
    customSetting,
  } = options || {};

  // Use options to configure your plugin
}
```

#### `config` (object)

The application's UDL configuration:

```javascript
export function onLoad({ config }) {
  const { port, host, endpoint } = config;

  // Access app-level configuration
  console.log(`Server will run on ${host}:${port}`);
}
```

## Real-World Example: Contentful Plugin

Here's the actual Contentful plugin from the UDL repository:

```javascript
// packages/contentful/udl.config.js
export const config = {
  type: 'source',
  name: 'contentful',
  version: '0.0.1',
};

export function onLoad({ options, config }) {
  console.log('Plugin Contentful loaded', options, config);

  // In a real implementation, you would:
  // 1. Initialize Contentful client with options.spaceId and options.accessToken
  // 2. Set up data fetching functions
  // 3. Extend GraphQL schema with Contentful types
  // 4. Register resolvers for Contentful queries
}
```

## Plugin Best Practices

### 1. Validate Options

Always validate required options in your `onLoad` hook:

```javascript
export function onLoad({ options }) {
  if (!options?.apiKey) {
    throw new Error('apiKey is required for my-plugin');
  }

  if (!options?.spaceId) {
    throw new Error('spaceId is required for my-plugin');
  }
}
```

### 2. Handle Errors Gracefully

Wrap initialization logic in try-catch blocks:

```javascript
export async function onLoad({ options }) {
  try {
    await initializeClient(options);
    console.log('Plugin initialized successfully');
  } catch (error) {
    console.error('Failed to initialize plugin:', error);
    throw error;
  }
}
```

### 3. Use Async/Await

The `onLoad` hook supports async operations:

```javascript
export async function onLoad({ options }) {
  // Async initialization
  await setupDatabase(options);
  await loadSchemaExtensions();
  console.log('Async initialization complete');
}
```

### 4. Export Type Definitions (TypeScript)

If using TypeScript, export your types:

```typescript
// types.ts
export interface MyPluginOptions {
  apiKey: string;
  environment?: 'production' | 'staging';
}

// udl.config.ts
import type { MyPluginOptions } from './types';

export const config = {
  type: 'source',
  name: 'my-plugin',
  version: '1.0.0',
};

export function onLoad({ options }: { options?: MyPluginOptions }) {
  const { apiKey, environment = 'production' } = options || {};
  // ...
}
```

## Publishing Your Plugin

### As an npm Package

1. Add UDL as a peer dependency:

```json
{
  "name": "udl-plugin-myservice",
  "version": "1.0.0",
  "peerDependencies": {
    "universal-data-layer": "^0.0.1"
  }
}
```

2. Ensure `udl.config.js` is included in published files:

```json
{
  "files": [
    "dist",
    "udl.config.js"
  ]
}
```

3. Publish to npm:

```bash
npm publish
```

### As a Local Plugin

You can also use plugins locally without publishing:

```javascript
// app's udl.config.js
export const config = {
  plugins: [
    './local-plugins/my-plugin',  // Relative path
  ],
};
```

## Next Steps

- [Registering Plugins](/plugins/registering-plugins) - Learn how to use your plugin
- [Lifecycle Methods](/plugins/lifecycle-methods) - Advanced lifecycle hooks
