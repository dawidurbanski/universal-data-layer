---
title: Remote Sync
description: Sync data from a remote UDL server for local development
navigation:
  icon: i-lucide-cloud-download
---

## Overview

Remote sync allows a local UDL server to fetch and mirror data from a production UDL server. This is useful for local development when you want to work with real production data without configuring CMS credentials locally.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRODUCTION SERVER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Contentful  â”‚â”€â”€â”€â”€â–¶â”‚             â”‚â”€â”€â”€â”€â–¶â”‚                         â”‚   â”‚
â”‚  â”‚ Shopify     â”‚     â”‚   Plugins   â”‚     â”‚       Node Store        â”‚   â”‚
â”‚  â”‚ Custom CMS  â”‚     â”‚             â”‚     â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚                  â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                                          â”‚                       â”‚      â”‚
â”‚                                     /_sync              /ws (optional)  â”‚
â”‚                                          â”‚                       â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚                       â”‚
                                           â”‚    Initial Fetch      â”‚  Real-time
                                           â”‚    (all nodes)        â”‚  Updates
                                           â”‚                       â”‚
                                           â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LOCAL DEV SERVER                                â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Node Store                               â”‚    â”‚
â”‚  â”‚                    (mirror of production)                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚                              /graphql                                    â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚                           Your Application                               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## How It Works

### Step 1: Initial Sync

When the local server starts with `remote.url` configured:

```
Local Server                              Remote Server
     â”‚                                          â”‚
     â”‚  GET /_sync?since=1970-01-01T00:00:00Z   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                                          â”‚
     â”‚         { updated: [...], deleted: [] }  â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                          â”‚
     â”‚  Populate local node store               â”‚
     â”‚                                          â”‚
```

The local server requests all nodes by using the epoch timestamp. The remote server returns every node in its store.

### Step 2: WebSocket Connection (Optional)

If the remote server has WebSockets enabled, the local server connects for real-time updates:

```
Local Server                              Remote Server
     â”‚                                          â”‚
     â”‚  WebSocket: ws://remote/ws               â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                                          â”‚
     â”‚  { type: "subscribe", data: "*" }        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                                          â”‚
     â”‚  { type: "subscribed", types: [...] }    â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                          â”‚
```

### Step 3: Real-time Updates

When content changes on the remote server, updates flow automatically:

```
CMS Webhook                Remote Server                Local Server
     â”‚                           â”‚                            â”‚
     â”‚  Content Updated          â”‚                            â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                            â”‚
     â”‚                           â”‚                            â”‚
     â”‚                           â”‚  { type: "node:updated",   â”‚
     â”‚                           â”‚    nodeId: "...",          â”‚
     â”‚                           â”‚    data: {...} }           â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                           â”‚                            â”‚
     â”‚                           â”‚          Update local storeâ”‚
     â”‚                           â”‚                            â”‚
```

## Configuration

### Basic Setup

```typescript [udl.config.ts]
import { defineConfig } from 'universal-data-layer';

export const config = defineConfig({
  port: 4000,
  remote: {
    url: 'https://production-udl.example.com',
  },
});
```

### What Gets Skipped

When `remote.url` is set, the local server:

- **Skips** plugin loading (no `sourceNodes` calls)
- **Skips** webhook handlers (remote handles those)
- **Keeps** local GraphQL endpoint active
- **Keeps** local codegen working (if configured)

## Use Cases

### Local Development with Production Data

Work with real content without CMS credentials:

```typescript [udl.config.ts]
export const config = defineConfig({
  remote: {
    url: process.env.PRODUCTION_UDL_URL,
  },
  codegen: {
    output: './generated',
  },
});
```

### CI/CD Preview Builds

Preview deployments can sync from production:

```typescript [udl.config.ts]
export const config = defineConfig({
  remote: {
    // Production UDL for preview builds
    url: process.env.CI ? process.env.PRODUCTION_UDL_URL : undefined,
  },
  plugins: process.env.CI ? [] : [
    // Local dev uses plugins directly
    { name: '@universal-data-layer/plugin-source-contentful', options: {...} },
  ],
});
```

### Staging Environments

Staging can mirror production data:

```
Production UDL â”€â”€â”€â”€â”€â”€â–¶ Staging UDL (remote sync)
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Local Dev (remote sync)
```

## WebSocket Behavior

The WebSocket connection is optional and graceful:

| Remote Server State | Local Server Behavior |
|--------------------|-----------------------|
| WebSocket enabled | Connects and receives real-time updates |
| WebSocket disabled | Works fine, just no real-time updates |
| WebSocket unavailable | Logs message, continues without it |

To enable WebSocket on the production server:

```typescript [udl.config.ts (production)]
export const config = defineConfig({
  plugins: [...],
  remote: {
    websockets: {
      enabled: true,
    },
  },
});
```

## Comparison: Remote Sync vs Local Plugins

| Aspect | Remote Sync | Local Plugins |
|--------|-------------|---------------|
| CMS credentials | Not needed locally | Required locally |
| Data freshness | Mirrors production | Direct from CMS |
| Webhook handling | Remote server | Local server |
| Network dependency | Requires remote UDL | Requires CMS APIs |
| Setup complexity | Minimal | Requires plugin config |

## Troubleshooting

### Connection Refused

```
Error: Failed to fetch from remote UDL: ECONNREFUSED
```

- Verify the remote URL is correct
- Check if the remote server is running
- Ensure network/firewall allows the connection

### Empty Node Store

If no nodes are loaded:

1. Check remote server has data: `curl https://remote/_sync?since=1970-01-01T00:00:00Z`
2. Verify the response contains `updated` array with nodes
3. Check for errors in local server logs

### WebSocket Not Connecting

This is normal if the remote server doesn't have WebSocket enabled. The local server will log:

```
ğŸ“¡ Remote WebSocket not available (this is fine if remote has websockets disabled)
```

## Next Steps

- [Production Deployment](/deployment/production-overview) - Deploy the production server
- [Webhook Setup](/deployment/webhook-setup) - Configure CMS webhooks on production
